class App extends PIXI.Application{constructor(i,t,d){super({width:i,height:t,backgroundColor:d,resolution:window.devicePixelRatio||1})}domElement(){return this.view}addChild(i){this.stage.addChild(i)}onUpdate(i){this.ticker.add(i)}}
class BorderText extends PIXI.Text{constructor(e,s){super(e,Object.assign({fill:GameColors.white,fontSize:16,stroke:GameColors.black,strokeThickness:5},s))}}
class Button extends PIXI.Container{constructor({text:t,action:i=function(){},color:h="white",margin:e=10}){super(),this.text=t,this.action=i,this.color=h,this.margin=e,this.box=PIXI.Sprite.from(PIXI.Texture.WHITE),this.box.tint=h,this.addChild(this.box),t&&(this.text=new PIXI.Text(t,{fill:GameColors.white}),this.addChild(this.text),this.text.x=e,this.text.y=e/2),this.box.width=this.text.width+2*e,this.box.height=this.text.height+e,this.buttonMode=!0,this.interactive=!0,this.on("tap",i),this.on("click",i),this.hitArea=new PIXI.Rectangle(0,0,this.box.width,this.box.height)}}
class DialoguePrompt extends PIXI.Container{constructor(t,e){super(),this.bind=createBinder(this),this.margin=50/1080*window.innerHeight,this.title=new BorderText(t,{fill:GameColors.white,fontSize:50}),this.addChild(this.title),centerTo(this.title,game.getScreen()),this.title.y=this.margin,this.submit=new Button({text:"Submit",action:e,color:GameColors.azure,margin:20}),centerTo(this.submit,game.getScreen()),this.submit.y=game.getScreen().height-this.margin-this.submit.height,this.addChild(this.submit)}update(t){this.margin=50/1080*window.innerHeight,centerTo(this.title,game.getScreen()),this.title.y=this.margin,centerTo(this.submit,game.getScreen()),this.submit.y=game.getScreen().height-this.margin-this.submit.height}mouseDown(t){}mouseMove(t){}mouseUp(t){}}
class DrawCharacterScreen extends DialoguePrompt{constructor(e,a){super(e,a),this.drawingSpace=new DrawSpace(100,100),centerTo(this.drawingSpace,game.getScreen()),this.addChild(this.drawingSpace);var t=new PIXI.Container;this.addChild(t);var i=this.drawingSpace.pen,r=0;for(var s in GameColors){var o=new Button({text:"hi",action:function(){i.color=numberToColor(this.color)},color:GameColors[s]});o.width=o.height=50,this.updatePalletColor(o,r++),t.addChild(o)}this.pallet=t,centerTo(this.pallet,game.getScreen())}updatePalletColor(e,a){var t=Math.round(a*e.width);e.x=t%this.drawingSpace.width,e.y=Math.floor(t/this.drawingSpace.width)*e.height}update(e){this.drawingSpace.update();var a=0;for(var t of this.pallet.children)this.updatePalletColor(t,a++);centerTo(this.pallet,game.getScreen()),this.pallet.y=game.getScreen().height/2+this.drawingSpace.height/2,centerTo(this.drawingSpace,game.getScreen()),super.update(e)}destroy(e){super.destroy(e),this.drawingSpace.destroy()}localisePos(e,a){return[e-this.x-this.drawingSpace.x,a-this.y-this.drawingSpace.y]}mouseDown(e){this&&this.drawingSpace.startDrawing(...this.localisePos(e.pageX,e.pageY))}mouseMove(e){this&&this.drawingSpace.draw(...this.localisePos(e.pageX,e.pageY))}mouseUp(e){this&&(enableScroll(),this.drawingSpace.stopDrawing())}}
class DrawSpace extends PIXI.Container{constructor(t,e){super(),this.stage=new createjs.Stage(document.createElement("canvas")),this.stage.canvas.width=t,this.stage.canvas.height=e,this.background=PIXI.Sprite.from(PIXI.Texture.WHITE),this.background.width=t,this.background.height=e,this.addChild(this.background),this.sprite=new PIXI.Sprite(PIXI.Texture.from(this.stage.canvas)),this.addChild(this.sprite),this.drawing=new createjs.Shape,this.stage.addChild(this.drawing),this.pen={color:"#ff00ff",size:2},this.stopDrawing(),this.stage.update(),this.width=500,this.height=this.width*e/t}setSize(t,e){this.stage.canvas.width=e,this.stage.canvas.height=t}startDrawing(t,e){this.pen.active=!0,this.draw(t,e)}stopDrawing(t,e){!this.pen.moved&&t&&e&&this.draw(t,e),this.pen.active=!1,this.pen.moved=!1,this.pen.x=this.pen.y=null}draw(t,e){t/=5,e/=5,this.pen.active&&(this.pen.x&&(this.moved=!0,this.drawing.graphics.beginStroke(this.pen.color).setStrokeStyle(this.pen.size,"round").moveTo(this.pen.x||t,this.pen.y||e).lineTo(t,e),this.stage.update(),this.sprite.texture.update()),this.pen.x=t,this.pen.y=e)}async createBlob(){return new Promise((t,e)=>{this.stage.canvas.toBlob(t,"image/png",1)})}update(t){window.innerWidth<500?this.width=window.innerWidth:this.width=500,this.height=this.width*this.stage.canvas.height/this.stage.canvas.width}destroy(){this.stage.removeAllChildren(),this.stage.removeAllEventListeners(),this.stage._eventListeners=null}}
class EnterTextScreen extends DialoguePrompt{constructor(t,e){super(t,e),this.submit=e,this.textInput=new PIXI.TextInput({input:{fontSize:"36px",padding:"12px",width:"500px",color:"#26272E"},box:{default:{fill:15264243,rounded:12,stroke:{color:13356768,width:3}},focused:{fill:14803950,rounded:12,stroke:{color:11251654,width:3}},disabled:{fill:14408667,rounded:12}}}),this.textInput.placeholder=t,centerTo(this.textInput,game.getScreen()),this.addChild(this.textInput)}update(t){centerTo(this.textInput,game.getScreen()),super.update(t)}}
class Game{constructor(){this.bind=createBinder(this),this.touchHandler=new TouchHandler,this.app=new App(window.innerWidth,window.innerHeight,"#000000"),this.playerInfo={},document.body.appendChild(this.app.domElement()),this.app.onUpdate(this.bind("update")),window.addEventListener("mousedown",this.bind("mouseDown")),window.addEventListener("mouseup",this.bind("mouseUp")),window.addEventListener("mousemove",this.bind("mouseMove")),window.addEventListener("resize",this.bind("windowResize"))}getScreen(){return this.app.screen}update(e){this.dialogue&&this.dialogue.update&&this.dialogue.update(e),this.world&&this.world.update&&this.world.update(e)}startGame(e){this.dialogue&&(this.dialogue.destroy(),delete this.dialogue);var i=io(e);this.socket=i,this.dialogue=new BorderText("Connecting To Server...",{fontSize:60}),centerTo(this.dialogue,this.getScreen()),this.app.addChild(this.dialogue),i.on("connect",this.bind("connectedToServer"))}connectedToServer(){this.dialogue&&(this.dialogue.destroy(),delete this.dialogue),console.log("Connected To Server"),this.dialogue=new EnterTextScreen("Enter Username",this.bind("createCharacter")),this.app.addChild(this.dialogue)}createCharacter(){this.dialogue&&(this.playerInfo.name=this.dialogue.textInput.text,this.dialogue.destroy(),delete this.dialogue),this.dialogue=new DrawCharacterScreen("Draw a character",this.bind("login")),this.app.addChild(this.dialogue)}async login(){this.dialogue&&(this.playerInfo.textureBlob=await this.dialogue.drawingSpace.createBlob(),this.dialogue.destroy({children:!0}),delete this.dialogue),this.world=new World,this.app.addChild(this.world),this.playerInfo&&this.emit("joinGame",this.playerInfo)}emit(...e){this.socket&&this.socket.emit(...e)}on(...e){this.socket&&this.socket.on(...e)}mouseDown(e){this.dialogue&&this.dialogue.mouseDown&&this.dialogue.mouseDown(e),this.world&&this.world.mouseDown&&this.world.mouseDown(e)}mouseMove(e){this.dialogue&&this.dialogue.mouseMove&&this.dialogue.mouseMove(e)}mouseUp(e){this.dialogue&&this.dialogue.mouseUp&&this.dialogue.mouseUp(e)}windowResize(e){this.app.resizeTo=document.body,this.app.resize()}}
PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST;
class Player extends PIXI.Sprite{constructor(t){super(PIXI.Texture.from(URL.createObjectURL(t.textureBlob))),this.x=t.x||game.app.screen.width/2,this.y=t.y||game.app.screen.height/2,this.playerId=t.id,this.name=t.name,this.speed=3,this.destination={x:this.x,y:this.y},this.nicknameSprite=new BorderText(this.name),this.addChild(this.nicknameSprite)}update(){var t=moveTowards({x:this.x,y:this.y},this.destination,this.speed);this.x=t.x,this.y=t.y,centerTo(this.nicknameSprite,this),this.nicknameSprite.y=0}moveTo(t){this.destination={x:t.x-this.width/2,y:t.y-3/4*this.height}}}
var GameColors={red:16711680,orange:16744192,yellow:16776960,lime:8388352,green:65280,springGreen:65407,cyan:65535,azure:32767,blue:255,violet:8323327,black:0,grey:8421504,white:16777215,rose:16711807,magenta:16711935};
class Room extends PIXI.Container{constructor(o){super()}}
var keys={37:1,38:1,39:1,40:1};function preventDefault(e){e.preventDefault()}function preventDefaultForScrollKeys(e){if(keys[e.keyCode])return preventDefault(e),!1}var supportsPassive=!1;try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:function(){supportsPassive=!0}}))}catch(e){}var wheelOpt=!!supportsPassive&&{passive:!1},wheelEvent="onwheel"in document.createElement("div")?"wheel":"mousewheel";function disableScroll(){window.addEventListener("DOMMouseScroll",preventDefault,!1),window.addEventListener(wheelEvent,preventDefault,wheelOpt),window.addEventListener("touchmove",preventDefault,wheelOpt)}function enableScroll(){window.removeEventListener("DOMMouseScroll",preventDefault,!1),window.removeEventListener(wheelEvent,preventDefault,wheelOpt),window.removeEventListener("touchmove",preventDefault,wheelOpt),window.removeEventListener("keydown",preventDefaultForScrollKeys,!1)}
class TouchHandler{constructor(){this.bind=createBinder(this),window.addEventListener("touchstart",this.bind("touchStart")),window.addEventListener("touchmove",this.bind("touchMove")),window.addEventListener("touchcancel",this.bind("touchEnd")),window.addEventListener("touchend",this.bind("touchEnd")),this.lastTouches=[]}touchStart(o){Array(...o.touches).forEach(o=>{window.onmousedown&&window.onmousedown(o),window.dispatchEvent(new MouseEvent("mousedown",o))}),this.lastTouches=Array(...o.touches)}touchMove(o){Array(...o.touches).forEach(o=>{window.onmousedown&&window.onmousemove(o),window.dispatchEvent(new MouseEvent("mousemove",o))}),this.lastTouches=Array(...o.touches)}touchEnd(o){var t=Array(...o.touches);0==o.touches.length&&(t=this.lastTouches),t.forEach(o=>{window.onmousedown&&window.onmouseup(o),window.dispatchEvent(new MouseEvent("mouseup",o))}),this.lastTouches=Array(...o.touches)}}
function createBinder(n){return function(n,...t){return this[n].bind(this,...t)}.bind(n)}function blobFromBytes(n){return new Blob([n],{type:"image/png"})}function centerTo(n,t){t||(t={width:0,height:0}),n.x=t.width/2-n.width/2,n.y=t.height/2-n.height/2}function numberToColor(n){var t=n.toString(16);return"#000000".substr(0,7-t.length)+t}function lerpXY(n,t,e){return{x:n.x+e*(t.x-n.x),y:n.y+e*(t.y-n.y)}}function vec(...n){return 1==n.length?"object"==typeof n[0]?Object.values(n[0]):n[0]:n}function mag2(...n){return(n=vec(...n)).reduce((n,t)=>n+t*t,0)}function mag(...n){return Math.sqrt(mag2(...n))}function norm(...n){n=vec(...n);var t=mag(...n);return n.map(n=>n/t)}function subVec(n,t){return vec(n).map((n,e)=>n-vec(t)[e])}function addVec(n,t){return vec(n).map((n,e)=>n+vec(t)[e])}function multVec(n,t){return vec(n).map((n,e)=>n*vec(t)[e])}function divVec(n,t){return vec(n).map((n,e)=>n/vec(t)[e])}function moveTowards(n,t,e){var r=t.x-n.x,c=t.y-n.y;if(mag([r,c])>e){Math.atan2(c,r);var u=norm([r,c]);r=u[0]*e,c=u[1]*e}return{x:n.x+r,y:n.y+c}}
class World extends PIXI.Container{constructor(){super(),this.bind=createBinder(this),this.players={},this.bindSocket("joinGame"),this.bindSocket("addPlayer"),this.bindSocket("removePlayer"),this.bindSocket("movePlayer"),this.bindSocket("updateRooms")}bindSocket(e){game.on(e,(...a)=>{console.log(e,...a),this.bind(e)(...a)})}update(e){Object.values(this.players).forEach(a=>a.update(e))}mouseDown(e){var a={x:e.pageX,y:e.pageY};game.player.moveTo(a),game.emit("movePlayer",a)}joinGame(e){for(var a of(game.playerInfo.id=e.id,e.players)){var r=this.addPlayer(a);e.id==a.id&&(game.player=r)}}addPlayer(e){if(!this.players[e.id||e.name]){e.textureBlob=blobFromBytes(e.textureBlob);var a=new Player(e);return this.players[e.id||e.name]=a,this.addChild(a),a}}removePlayer(e){this.players[e].destroy({children:!0}),delete this.players[e]}movePlayer(e){this.players[e.id].moveTo(e)}updateRooms(e){}}
//# sourceMappingURL=game.min.js.map
