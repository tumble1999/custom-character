class App extends PIXI.Application{constructor(i,t,d){super({width:i,height:t,backgroundColor:d,resolution:window.devicePixelRatio||1})}domElement(){return this.view}addChild(i){this.stage.addChild(i)}onUpdate(i){this.ticker.add(i)}}
class Button extends PIXI.Container{constructor(t,i,h="white"){super(),this.action=i||function(){};this.box=PIXI.Sprite.from(PIXI.Texture.WHITE),this.box.tint=GameColors[h],this.addChild(this.box),this.text=new PIXI.Text(t,{fill:GameColors.white}),this.text.tint=GameColors.white,this.addChild(this.text),this.text.x=5,this.text.y=2.5,this.box.width=this.text.width+10,this.box.height=this.text.height+10,this.buttonMode=!0,this.interactive=!0,this.on("tap",t=>{console.log("hi"),this.action()}),this.hitArea=new PIXI.Rectangle(0,0,this.box.width,this.box.height)}}
class DrawCharacterScreen extends PIXI.Container{constructor(e){super(),this.bind=createBinder(this),this.drawingSpace=new DrawSpace(100,100),this.addChild(this.drawingSpace)}destroy(e){super.destroy(e),this.drawingSpace.destroy()}mouseDown(e){this&&this.drawingSpace.startDrawing(e.pageX-this.x,e.pageY-this.y)}mouseMove(e){this&&this.drawingSpace.draw(e.pageX-this.x,e.pageY-this.y)}mouseUp(e){this&&(enableScroll(),this.drawingSpace.stopDrawing())}}
class DrawSpace extends PIXI.Container{constructor(t,e){super(),this.stage=new createjs.Stage(document.createElement("canvas")),this.stage.canvas.width=t,this.stage.canvas.height=e,this.background=PIXI.Sprite.from(PIXI.Texture.WHITE),this.background.width=t,this.background.height=e,this.addChild(this.background),this.sprite=new PIXI.Sprite(PIXI.Texture.from(this.stage.canvas)),this.addChild(this.sprite),this.drawing=new createjs.Shape,this.stage.addChild(this.drawing),this.pen={color:"#ff00ff",size:2},this.stopDrawing(),this.stage.update(),this.width=500,this.height=500}setSize(t,e){this.stage.canvas.width=e,this.stage.canvas.height=t}startDrawing(t,e){this.pen.active=!0,this.draw(t,e)}stopDrawing(t,e){!this.pen.moved&&t&&e&&this.draw(t,e),this.pen.active=!1,this.pen.moved=!1,this.pen.x=this.pen.y=null}draw(t,e){t/=5,e/=5,this.pen.active&&(this.pen.x&&(this.moved=!0,this.drawing.graphics.beginStroke(this.pen.color).setStrokeStyle(this.pen.size,"round").moveTo(this.pen.x||t,this.pen.y||e).lineTo(t,e),this.stage.update(),this.sprite.texture.update()),this.pen.x=t,this.pen.y=e)}async createBlob(){return new Promise((t,e)=>{this.stage.canvas.toBlob(t,"image/png",1)})}destroy(){this.stage.removeAllChildren(),this.stage.removeAllEventListeners(),this.stage._eventListeners=null}}
class Game{constructor(){this.bind=createBinder(this),this.touchHandler=new TouchHandler,this.app=new App(window.innerWidth,window.innerHeight,"#000000"),document.body.appendChild(this.app.domElement()),this.app.onUpdate(this.bind("update")),window.addEventListener("mousedown",this.bind("mouseDown")),window.addEventListener("mouseup",this.bind("mouseUp")),window.addEventListener("mousemove",this.bind("mouseMove"));var e=new PIXI.Container;this.app.addChild(e);var i=new Button("New",this.bind("createCharacter"),"azure");i.x=-(i.width+2.5);var t=new Button("Submit?",this.bind("startGame"),"azure");t.x=2.5,e.addChild(i),e.addChild(t),e.x=this.app.screen.width/2,e.y=this.app.screen.height-5-e.height}async startGame(){this.dialogue&&(this.playerBlob=await this.dialogue.drawingSpace.createBlob(),this.dialogue.destroy({children:!0}),delete this.dialogue),this.world=new World,this.app.addChild(this.world),this.playerBlob&&(this.player=this.world.addPlayer(0,"Player",this.playerBlob))}update(e){this.world&&this.world.update(e)}createCharacter(){this.dialogue=new DrawCharacterScreen,this.dialogue.x=this.app.screen.width/2-this.dialogue.width/2,this.dialogue.y=this.app.screen.height/2-this.dialogue.height/2,this.app.addChild(this.dialogue)}mouseDown(e){this.dialogue&&this.dialogue.mouseDown(e),this.world&&this.world.mouseDown(e)}mouseMove(e){this.dialogue&&this.dialogue.mouseMove(e)}mouseUp(e){this.dialogue&&this.dialogue.mouseUp(e)}}
PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST;
class Player extends PIXI.Sprite{constructor(t,s,i){super(PIXI.Texture.from(URL.createObjectURL(i))),this.playerId=t,this.name=s,this.speed=3,this.destination={x:this.x,y:this.y}}update(){var t=moveTowards({x:this.x,y:this.y},this.destination,this.speed);this.x=t.x,this.y=t.y}moveTo(t,s){this.destination={x:t-this.width/2,y:s-3/4*this.height}}}
var GameColors={red:16711680,orange:16744192,yellow:16776960,line:8388352,green:65280,springGreen:65407,cyan:65535,azure:32767,blue:255,violet:8323327,magenta:16711935,rose:16711807,white:16777215,grey:8421504,black:0};
var keys={37:1,38:1,39:1,40:1};function preventDefault(e){e.preventDefault()}function preventDefaultForScrollKeys(e){if(keys[e.keyCode])return preventDefault(e),!1}var supportsPassive=!1;try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:function(){supportsPassive=!0}}))}catch(e){}var wheelOpt=!!supportsPassive&&{passive:!1},wheelEvent="onwheel"in document.createElement("div")?"wheel":"mousewheel";function disableScroll(){window.addEventListener("DOMMouseScroll",preventDefault,!1),window.addEventListener(wheelEvent,preventDefault,wheelOpt),window.addEventListener("touchmove",preventDefault,wheelOpt)}function enableScroll(){window.removeEventListener("DOMMouseScroll",preventDefault,!1),window.removeEventListener(wheelEvent,preventDefault,wheelOpt),window.removeEventListener("touchmove",preventDefault,wheelOpt),window.removeEventListener("keydown",preventDefaultForScrollKeys,!1)}
class TouchHandler{constructor(){this.bind=createBinder(this),window.addEventListener("touchstart",this.bind("touchStart")),window.addEventListener("touchmove",this.bind("touchMove")),window.addEventListener("touchcancel",this.bind("touchEnd")),window.addEventListener("touchend",this.bind("touchEnd")),this.lastTouches=[]}touchStart(o){Array(...o.touches).forEach(o=>{window.onmousedown&&window.onmousedown(o),window.dispatchEvent(new MouseEvent("mousedown",o))}),this.lastTouches=Array(...o.touches)}touchMove(o){Array(...o.touches).forEach(o=>{window.onmousedown&&window.onmousemove(o),window.dispatchEvent(new MouseEvent("mousemove",o))}),this.lastTouches=Array(...o.touches)}touchEnd(o){var t=Array(...o.touches);0==o.touches.length&&(t=this.lastTouches),t.forEach(o=>{window.onmousedown&&window.onmouseup(o),window.dispatchEvent(new MouseEvent("mouseup",o))}),this.lastTouches=Array(...o.touches)}}
function createBinder(n){return function(n,...e){return this[n].bind(this,...e)}.bind(n)}function blobFromBytes(n){return new Blob([n.buffer],{type:"image/png"})}function lerpXY(n,e,t){return{x:n.x+t*(e.x-n.x),y:n.y+t*(e.y-n.y)}}function vec(...n){return 1==n.length?"object"==typeof n[0]?Object.values(n[0]):n[0]:n}function mag2(...n){return(n=vec(...n)).reduce((n,e)=>n+e*e,0)}function mag(...n){return Math.sqrt(mag2(...n))}function norm(...n){n=vec(...n);var e=mag(...n);return n.map(n=>n/e)}function subVec(n,e){return vec(n).map((n,t)=>n-vec(e)[t])}function addVec(n,e){return vec(n).map((n,t)=>n+vec(e)[t])}function multVec(n,e){return vec(n).map((n,t)=>n*vec(e)[t])}function divVec(n,e){return vec(n).map((n,t)=>n/vec(e)[t])}function moveTowards(n,e,t){var r=e.x-n.x,c=e.y-n.y;if(mag([r,c])>t){Math.atan2(c,r);var u=norm([r,c]);r=u[0]*t,c=u[1]*t}return{x:n.x+r,y:n.y+c}}
class World extends PIXI.Container{constructor(){super(),this.bind=createBinder(this),this.players={}}update(e){Object.values(this.players).forEach(s=>s.update(e))}mouseDown(e){game.player.moveTo(e.pageX,e.pageY,0)}addPlayer(e,s,a){if(!this.players[e])return this.players[e]=new Player(e,s,a),this.addChild(this.players[e]),this.players[e]}}
//# sourceMappingURL=game.min.js.map
