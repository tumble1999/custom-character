class App extends PIXI.Application{constructor(i,t,e){super({width:i,height:t,backgroundColor:e,resolution:window.devicePixelRatio||1}),this.view.width=i,this.view.height=t}domElement(){return this.view}addChild(i){this.stage.addChild(i)}onUpdate(i){this.ticker.add(i)}}
class BorderText extends PIXI.Text{constructor(e,s){super(e,Object.assign({fill:GameColors.white,fontSize:16,stroke:GameColors.black,strokeThickness:5},s))}}
class Button extends PIXI.Container{constructor({text:t,action:i=function(){},color:h="white",margin:e=10}){super(),this.text=t,this.action=i,this.color=h,this.margin=e,this.box=PIXI.Sprite.from(PIXI.Texture.WHITE),this.box.tint=h,this.addChild(this.box),t&&(this.text=new PIXI.Text(t,{fill:GameColors.white}),this.addChild(this.text),this.text.x=e,this.text.y=e/2),this.box.width=this.text.width+2*e,this.box.height=this.text.height+e,this.buttonMode=!0,this.interactive=!0,this.on("tap",i),this.on("click",i),this.hitArea=new PIXI.Rectangle(0,0,this.box.width,this.box.height)}}
class DrawSpace extends PIXI.Container{constructor(t,e){super(),this.stage=new createjs.Stage(document.createElement("canvas")),this.stage.canvas.width=t,this.stage.canvas.height=e,this.background=PIXI.Sprite.from(PIXI.Texture.WHITE),this.background.width=t,this.background.height=e,this.addChild(this.background),this.sprite=new PIXI.Sprite(PIXI.Texture.from(this.stage.canvas)),this.addChild(this.sprite),this.drawing=new createjs.Shape,this.stage.addChild(this.drawing),this.pen={color:"#ff00ff",size:2},this.stopDrawing(),this.stage.update(),this.width=500,this.height=this.width*e/t}setSize(t,e){this.stage.canvas.width=e,this.stage.canvas.height=t}startDrawing(t){this.pen.active=!0,this.draw(t)}stopDrawing(t){!this.pen.moved&&t&&t.x&&t.y&&this.draw(t),this.pen.active=!1,this.pen.moved=!1,this.pen.x=this.pen.y=null}draw(t){t&&(t.x/=5,t.y/=5,this.pen.active&&(this.pen.x&&(this.moved=!0,this.drawing.graphics.beginStroke(this.pen.color).setStrokeStyle(this.pen.size,"round").moveTo(this.pen.x||t.x,this.pen.y||t.y).lineTo(t.x,t.y),this.stage.update(),this.sprite.texture.update()),this.pen.x=t.x,this.pen.y=t.y))}async createBlob(){return new Promise((t,e)=>{this.stage.canvas.toBlob(t,"image/png",1)})}update(t){window.innerWidth<500?this.width=window.innerWidth:this.width=500,this.height=this.width*this.stage.canvas.height/this.stage.canvas.width}destroy(){this.stage.removeAllChildren(),this.stage.removeAllEventListeners(),this.stage._eventListeners=null}}
class Game{constructor(){this.bind=createBinder(this),this.touchHandler=new TouchHandler,this.setupInput(),this.loader=new PIXI.Loader,this.data={maps:{},characters:{},input:{}},this.app=new App(window.innerWidth,window.innerHeight,"#000000"),this.info={},document.body.appendChild(this.app.domElement()),this.app.onUpdate(this.bind("update")),window.addEventListener("resize",this.bind("windowResize"))}setupInput(){this.input=new Input,this.inputManager=new InputManager,this.inputManager.onAxis("Down",(function(){var e=game.input.getKey(Keyboard.UP_ARROW)||game.input.getKey(Keyboard.KEY_W)?1:0;return(game.input.getKey(Keyboard.DOWN_ARROW)||game.input.getKey(Keyboard.KEY_S)?1:0)-e}),(function(){return game.input.getKeyDown(Keyboard.UP_ARROW)||game.input.getKeyDown(Keyboard.DOWN_ARROW)||game.input.getKeyDown(Keyboard.KEY_W)||game.input.getKeyDown(Keyboard.KEY_S)}),(function(){return game.input.getKeyUp(Keyboard.UP_ARROW)||game.input.getKeyUp(Keyboard.DOWN_ARROW)||game.input.getKeyUp(Keyboard.KEY_W)||game.input.getKeyUp(Keyboard.KEY_S)})),this.inputManager.onAxis("Right",(function(){var e=game.input.getKey(Keyboard.LEFT_ARROW)||game.input.getKey(Keyboard.KEY_A)?1:0;return(game.input.getKey(Keyboard.RIGHT_ARROW)||game.input.getKey(Keyboard.KEY_D)?1:0)-e}),(function(){return game.input.getKeyDown(Keyboard.LEFT_ARROW)||game.input.getKeyDown(Keyboard.RIGHT_ARROW)||game.input.getKeyDown(Keyboard.KEY_A)||game.input.getKeyDown(Keyboard.KEY_D)}),(function(){return game.input.getKeyUp(Keyboard.LEFT_ARROW)||game.input.getKeyUp(Keyboard.RIGHT_ARROW)||game.input.getKeyUp(Keyboard.KEY_A)||game.input.getKeyUp(Keyboard.KEY_D)})),this.inputManager.onButton("Submit",(function(){return game.input.getKeyDown(Keyboard.ENTER)}))}getScreen(){return this.app.screen}update(e){this.input&&this.input.update(),this.dialogue&&this.dialogue.update&&this.dialogue.update(e),this.world&&this.world.update&&this.world.update(e)}async loadFile(e){var t=this;return new Promise((a,i)=>{t.loader.add(e),t.loader.load((t,i)=>{a(i[e].data),console.log("File Loaded",e)})})}async loadImage(e){return new Promise((t,a)=>{var i=new Image;i.addEventListener("load",(function(){t(i),console.log("Image Loaded",e)})),i.setAttribute("src",e)})}startGame(e){this.dialogue&&(this.dialogue.destroy(),delete this.dialogue);var t=io(e);this.socket=t,this.dialogue=new BorderText("Connecting To Server...",{fontSize:60}),centerTo(this.dialogue,this.getScreen()),this.app.addChild(this.dialogue),t.on("connect",this.bind("connectedToServer"))}connectedToServer(){this.world&&(this.world.destroy({children:!0}),delete this.player,delete this.sector,this.info={},delete this.world),this.dialogue&&(this.dialogue.destroy(),delete this.dialogue),console.log("Connected To Server"),this.dialogue=new EnterTextScreen("Enter Username",this.bind("login")),this.app.addChild(this.dialogue)}getSectorName({x:e,y:t}){return e+"-"+t}async createCharacter(){console.log("Under Construction"),this.dialogue&&await this.cleanDialogue();var e=this;this.dialogue=new DrawCharacterScreen("Draw a character",async()=>{var t=await e.dialogue.drawingSpace.createBlob();game.player.updateCharacter({textureBlob:t}),game.emit("createCharacter",{textureBlob:t}),e.cleanDialogue()}),this.app.addChild(this.dialogue)}async cleanDialogue(){var e=!0;this.dialogue.textInput&&(this.info.name=this.dialogue.textInput.text,e=!1),this.dialogue.destroy({children:e}),delete this.dialogue}async login(){this.dialogue&&this.cleanDialogue(),this.data.characters.default=await this.loadFile("media/default.png"),this.world=new World,this.app.addChild(this.world);var e=new Button({text:"Change Character",action:this.bind("createCharacter"),color:GameColors.orange,margin:20});e.x=game.getScreen().width-e.width-10,e.y=game.getScreen().height-e.height-10,this.app.addChild(e),e&&console.log("dsdasdas"),this.info&&this.emit("joinGame",this.info)}emit(...e){this.socket&&this.socket.emit(...e)}on(...e){this.socket&&this.socket.on(...e)}windowResize(e){this.app.resizeTo=document.body,this.app.resize()}}
class PixelQueryer{constructor(t){var e=document.createElement("canvas");e.width=t.width,e.height=t.height,this.context=e.getContext("2d"),this.context.drawImage(t,0,0,t.width,t.height)}getPixel(t){var e=Array.from(this.context.getImageData(t.x,t.y,1,1).data);return e[0]<<16|e[1]<<8|e[2]}}
PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST;
class Player extends PIXI.Container{constructor(t){super(),this.id=t.id,this.name=t.name,this.destination={x:this.x,y:this.y},this.moving=!1,this.dx=0,this.dy=0,this.abilities=[],this.abilities.length=4,this.animation={yMax:6,speed:.013},this.character=new PIXI.Sprite(PIXI.Texture.from(game.data.characters.default)),this.addChild(this.character),this.nicknameSprite=new BorderText(this.name),this.addChild(this.nicknameSprite),this.updateInfo(t)}get worldPos(){return{x:this.sector.x*game.info.SECTOR_SIZE+this.x,y:this.sector.y*game.info.SECTOR_SIZE+this.y}}async updateInfo(t){this.info=t,t.textureBlob&&(this.character.texture=PIXI.Texture.from(URL.createObjectURL(t.textureBlob)));var i=subVec({x:this.x,y:this.y},this.destination);this.map=t.map,this.x=t.x+i[0],this.y=t.y+i[1],this.sector=t.sector,this.sectorName=game.getSectorName(t.sector),this.speed=t.speed,this.dx=t.dx,this.dy=t.dy}collidingWithWall(){return!game.world.withinWorld(this.worldPos)||this.getSector().collision&&this.getSector().collision.getPixel(this)==GameColors.green}updateCharacter(t){this.info.textureBlob=t.textureBlob,this.character.texture=PIXI.Texture.from(URL.createObjectURL(t.textureBlob))}updateFloatAnimation(){var t=this.animation.speed;this.moving&&(t*=this.speed);var i=performance.now()*t/this.animation.yMax;this.character.y=(Math.sin(i)-1)*this.animation.yMax}getSector(){return game.world.sectors[this.sectorName]}update(){if(this.moving=0!=this.dx||0!=this.dy,this.moving){var t=this.x,i=this.y;this.x+=this.dx*this.speed,this.y+=this.dy*this.speed,this.collidingWithWall()&&(this.x=t,this.y=i)}centerTo(this.nicknameSprite,this),this.nicknameSprite.y=0,this.updateFloatAnimation()}moveBy(t){t.x&&(this.info.x=this.x=t.x),t.y&&(this.info.y=this.y=t.y),isNaN(t.dx)||(this.info.dx=this.dx=t.dx),isNaN(t.dy)||(this.info.dy=this.dy=t.dy)}moveTo(t){this.info.x=t.x,this.info.y=t.y;this.destination={x:t.x-this.width/2,y:t.y-3/4*this.height}}destroy(t){super.destroy(t),console.log(this.name,"destroyed")}}
var GameColors={red:16711680,orange:16744192,yellow:16776960,lime:8388352,green:65280,springGreen:65407,cyan:65535,azure:32767,blue:255,violet:8323327,black:0,grey:8421504,white:16777215,rose:16711807,magenta:16711935};
var keys={37:1,38:1,39:1,40:1};function preventDefault(e){e.preventDefault()}function preventDefaultForScrollKeys(e){if(keys[e.keyCode])return preventDefault(e),!1}var supportsPassive=!1;try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:function(){supportsPassive=!0}}))}catch(e){}var wheelOpt=!!supportsPassive&&{passive:!1},wheelEvent="onwheel"in document.createElement("div")?"wheel":"mousewheel";function disableScroll(){window.addEventListener("DOMMouseScroll",preventDefault,!1),window.addEventListener(wheelEvent,preventDefault,wheelOpt),window.addEventListener("touchmove",preventDefault,wheelOpt)}function enableScroll(){window.removeEventListener("DOMMouseScroll",preventDefault,!1),window.removeEventListener(wheelEvent,preventDefault,wheelOpt),window.removeEventListener("touchmove",preventDefault,wheelOpt),window.removeEventListener("keydown",preventDefaultForScrollKeys,!1)}
class Sector extends PIXI.Container{constructor(e){super(),this.info=e,this.id=e.id||e.name,this.name=e.name,this.x=e.x,this.y=e.y,this.players={},game.data.maps[game.info.map][this.id]&&(this.data=game.data.maps[game.info.map][this.id],this.loadData()),this.data&&this.data.background?this.background=PIXI.Sprite.from(PIXI.Texture.from(this.data.background)):(this.background=PIXI.Sprite.from(PIXI.Texture.WHITE),this.background.tint=65536*e.x+256*e.y+255),this.background.width=this.background.height=game.info.SECTOR_SIZE,this.addChild(this.background),this.updatePlayers()}async loadData(){this.data.collisionMap&&(this.collision=new PixelQueryer(await game.loadFile(this.data.collisionMap)))}update(e){if(game.player){var t=game.world.worldToScreen(this.info);this.x=t.x,this.y=t.y,Object.values(this.players).forEach(t=>t.update(e))}}worldToSector(e={x:0,y:0}){return{x:e.x-this.info.x,y:e.y-this.info.y}}sectorToWorld(e={x:0,y:0}){return{x:e.x+this.info.x,y:e.y+this.info.y}}updatePlayers(){var e=this,t=game.info.players.filter(t=>e.name==t.sector.x+"-"+t.sector.y);for(var a in this.players)t.map(e=>e.id).includes(a)||this.removePlayer(a);for(var i of t){a=this.addPlayer(i);game.info.id==i.id&&(game.player=a,this.removeChild(a),this.addChild(a))}}addPlayer(e){if(e.textureBlob=blobFromBytes(e.textureBlob),this.players[e.id])return this.players[e.id].updateInfo(e),this.players[e.id];var t=new Player(e);return this.players[e.id]=t,this.addChild(t),t}removePlayer(e){this.removeChild(this.players[e]),this.players[e].destroy({children:!0}),delete this.players[e]}movePlayer(e){this.players[e.id].moveBy(e)}updateCharacter(e){var t=this.players[e.id];e.textureBlob=blobFromBytes(e.textureBlob),t.updateCharacter(e)}destroy(e){super.destroy(e),console.log(this.name,"destroyed")}}
function createBinder(n){var e={};return function(n,...t){var r=e[n];return r||(r=this[n].bind(this,...t),e[n]=r),r}.bind(n)}function blobFromBytes(n){if(n)return new Blob([n],{type:"image/png"})}function isBoolean(n){return"boolean"==typeof n}function centerTo(n,e){e||(e={width:0,height:0}),n.x=e.width/2-n.width/2,n.y=e.height/2-n.height/2}function numberToColor(n){var e=n.toString(16);return"#000000".substr(0,7-e.length)+e}function lerpXY(n,e,t){return{x:n.x+t*(e.x-n.x),y:n.y+t*(e.y-n.y)}}function vec(...n){return 1==n.length?"object"==typeof n[0]?Object.values(n[0]):n[0]:n}function mag2(...n){return(n=vec(...n)).reduce((n,e)=>n+e*e,0)}function mag(...n){return Math.sqrt(mag2(...n))}function norm(...n){n=vec(...n);var e=mag(...n);return n.map(n=>n/e)}function subVec(n,e){return vec(n).map((n,t)=>n-vec(e)[t])}function addVec(n,e){return vec(n).map((n,t)=>n+vec(e)[t])}function multVec(n,e){return vec(n).map((n,t)=>n*vec(e)[t])}function divVec(n,e){return vec(n).map((n,t)=>n/vec(e)[t])}function moveTowards(n,e,t){var r=e.x-n.x,u=e.y-n.y;if(mag([r,u])>t){var c=norm([r,u]);r=c[0]*t,u=c[1]*t}return{x:n.x+r,y:n.y+u}}
class World extends PIXI.Container{constructor(){super(),this.bind=createBinder(this),this.sectors={},this.players={},game.data.maps[game.info.map]&&(this.data=game.data.maps[game.info.map],this.loadData()),this.bindSocket("joinGame"),this.bindSocket("joinMap"),this.bindSocket("joinSector"),this.bindSocket("addPlayer"),this.bindSocket("removePlayer"),this.bindSocket("movePlayer"),this.bindSocket("updateCharacter")}async loadData(){this.data.sectorMap&&(this.sectorMap=await game.loadImage(this.data.sectorMap))}bindSocket(e){game.on(e,(...a)=>{console.log(e,...a),this.bind(e)(...a)})}screenToWorld(e){var a=game.sector?game.sector.sectorToWorld(game.player):game.player;return{x:e.x-game.getScreen().width/2+a.x,y:e.y-game.getScreen().height/2+a.y}}worldToScreen(e){var a=game.sector?game.sector.sectorToWorld(game.player):game.player;return{x:e.x-a.x+game.getScreen().width/2,y:e.y-a.y+game.getScreen().height/2}}getSectorName({x:e,y:a}){return e+"-"+a}withinWorld(e){var a=game.data.maps[game.info.map].bounds;return a.x*game.info.SECTOR_SIZE<=e.x&&e.x<(a.width+1)*game.info.SECTOR_SIZE&&a.y*game.info.SECTOR_SIZE<=e.y&&e.y<(a.height+1)*game.info.SECTOR_SIZE}update(e){this.updateInput(e),Object.values(this.sectors).forEach(a=>a.update(e))}updateInput(e){if(game.player){if(game.input.getMouseDown(Mouse.MIDDLE_CLICK))this.x=0,this.y=0;else{var a=game.input.getMouseScroll();game.input.getKey(Keyboard.ALT)?this.x-=a.y*e:(this.x-=a.x*e,this.y-=a.y*e)}(game.inputManager.axisChanged("Down")||game.inputManager.axisChanged("Right"))&&(game.player.moveBy({dx:game.inputManager.getAxis("Right"),dy:game.inputManager.getAxis("Down")}),game.emit("movePlayer",{x:game.player.x,y:game.player.y,dx:game.player.dx,dy:game.player.dy}))}}async joinGame(e){game.info.id=e.id,game.info.server=e.server,game.info.SECTOR_SIZE=e.SECTOR_SIZE,await this.joinMap(e)}async joinMap(e){game.info.map=e.map,game.data.maps[e.map]=await game.loadFile("data/maps/"+e.map+".json"),await this.joinSector(e)}async joinSector(e){for(var a in game.info.sector=e.sector,game.info.players=e.players,game.info.sectors=e.sectors,this.sectors)!e.sectors.map(e=>e.name).includes(a)&&this.withinWorld(a)&&this.removeSector(a);for(var t of e.sectors){a=this.addSector(t);game.info.sector==t.name&&(game.sector=a,this.removeChild(a),this.addChild(a))}}addSector(e){if(this.sectors[e.name])return this.sectors[e.name].updatePlayers(e.players),this.sectors[e.name];var a=new Sector(e);return this.sectors[e.name]=a,this.addChild(a),a}removeSector(e){this.removeChild(this.sectors[e]),this.sectors[e].destroy({children:!0}),delete this.sectors[e]}addPlayer(e){var a=this.sectors[e.sector]||game.sector;game.info.players.map(e=>e.id).includes(e.id)||game.info.players.push(e),a.addPlayer(e)}removePlayer(e){var a=this.sectors[e.sector]||game.sector;game.info.players.map(e=>e.id).includes(e.id)&&(game.info.player=game.info.players.filter(a=>a!=e.id)),a.removePlayer(e.id)}movePlayer(e){(this.sectors[e.sector]||game.sector).movePlayer(e)}updateCharacter(e){(this.sectors[e.sector]||game.sector).updateCharacter(e)}}
class DialoguePrompt extends PIXI.Container{constructor(t,e){super(),this.bind=createBinder(this),this.margin=50/1080*window.innerHeight,this.title=new BorderText(t,{fill:GameColors.white,fontSize:50}),this.addChild(this.title),centerTo(this.title,game.getScreen()),this.title.y=this.margin,this.submit=new Button({text:"Submit",action:e,color:GameColors.azure,margin:20}),centerTo(this.submit,game.getScreen()),this.submit.y=game.getScreen().height-this.margin-this.submit.height,this.addChild(this.submit)}updateInput(){game.inputManager.getButton("Submit")&&this.submit.action()}update(t){this.updateInput(),this.margin=50/1080*window.innerHeight,centerTo(this.title,game.getScreen()),this.title.y=this.margin,centerTo(this.submit,game.getScreen()),this.submit.y=game.getScreen().height-this.margin-this.submit.height}mouseDown(t){}mouseMove(t){}mouseUp(t){}}
class DrawCharacterScreen extends DialoguePrompt{constructor(e,t){super(e,t),this.drawingSpace=new DrawSpace(100,100),centerTo(this.drawingSpace,game.getScreen()),this.addChild(this.drawingSpace);var i=new PIXI.Container;this.addChild(i);var a=this.drawingSpace.pen,o=0;for(var r in GameColors){var s=new Button({text:" ",action:function(){a.color=numberToColor(this.color)},color:GameColors[r]});s.width=s.height=50,this.updatePalletColor(s,o++),i.addChild(s)}this.pallet=i,centerTo(this.pallet,game.getScreen()),window.addEventListener("mousedown",this.bind("mouseDown"),!0),window.addEventListener("mouseup",this.bind("mouseUp"),!0),window.addEventListener("mousemove",this.bind("mouseMove"),!0)}updatePalletColor(e,t){var i=Math.round(t*e.width);e.x=i%this.drawingSpace.width,e.y=Math.floor(i/this.drawingSpace.width)*e.height}update(e){this.drawingSpace.update();var t=0;for(var i of this.pallet.children)this.updatePalletColor(i,t++);centerTo(this.pallet,game.getScreen()),this.pallet.y=game.getScreen().height/2+this.drawingSpace.height/2,centerTo(this.drawingSpace,game.getScreen()),super.update(e)}destroy(e){window.removeEventListener("mousedown",this.bind("mouseDown"),!0),window.removeEventListener("mouseup",this.bind("mouseUp"),!0),window.removeEventListener("mousemove",this.bind("mouseMove"),!0),super.destroy(e),this.drawingSpace.destroy()}localisePos(e){return{x:e.x-this.x-this.drawingSpace.x,y:e.y-this.y-this.drawingSpace.y}}mouseDown(e){if(this){var t={x:e.pageX,y:e.pageY};this.drawingSpace.startDrawing(this.localisePos(t))}}mouseMove(e){if(this){var t={x:e.pageX,y:e.pageY};this.drawingSpace.draw(this.localisePos(t))}}mouseUp(e){this&&(enableScroll(),this.drawingSpace.stopDrawing())}}
class EnterTextScreen extends DialoguePrompt{constructor(t,e){super(t,e),this.textInput=new PIXI.TextInput({input:{fontSize:"36px",padding:"12px",width:"500px",color:"#26272E"},box:{default:{fill:15264243,rounded:12,stroke:{color:13356768,width:3}},focused:{fill:14803950,rounded:12,stroke:{color:11251654,width:3}},disabled:{fill:14408667,rounded:12}}}),this.textInput.placeholder=t,centerTo(this.textInput,game.getScreen()),this.addChild(this.textInput),this.textInput.focus()}update(t){centerTo(this.textInput,game.getScreen()),super.update(t)}}
class Input{constructor(){this.NUM_KEYCODES=256,this.NUM_MOUSEBUTTONS=5,this.currentKeys=[],this.downKeys=[],this.upKeys=[],this.currentMouse=[],this.downMouse=[],this.upMouse=[]}update(){this.upKeys=[];for(let e=0;e<this.NUM_KEYCODES;e++)!this.getKey(e)&&this.currentKeys.includes(e)&&this.upKeys.push(e);this.downKeys=[];for(let e=0;e<this.NUM_KEYCODES;e++)this.getKey(e)&&!this.currentKeys.includes(e)&&this.downKeys.push(e);this.currentKeys=[];for(let e=0;e<this.NUM_KEYCODES;e++)this.getKey(e)&&this.currentKeys.push(e);this.upMouse=[];for(let e=0;e<this.NUM_MOUSEBUTTONS;e++)!this.getMouse(e)&&this.currentMouse.includes(e)&&this.upMouse.push(e);this.downMouse=[];for(let e=0;e<this.NUM_MOUSEBUTTONS;e++)this.getMouse(e)&&!this.currentMouse.includes(e)&&this.downMouse.push(e);this.currentMouse=[];for(let e=0;e<this.NUM_MOUSEBUTTONS;e++)this.getMouse(e)&&this.currentMouse.push(e)}getKey(e){return Keyboard.IsKeyDown(e)}getKeyDown(e){return this.downKeys.includes(e)}getKeyUp(e){return this.upKeys.includes(e)}getMouse(e){return Mouse.IsButtonDown(e)}getMouseDown(e){return this.downMouse.includes(e)}getMouseUp(e){return this.upMouse.includes(e)}getMousePos(){return{x:Mouse.GetX(),y:Mouse.GetY()}}getMouseMovement(){return{x:Mouse.GetMovementX(),y:Mouse.GetMovementY()}}getMouseScroll(){return{x:Mouse.GetScrollX(),y:Mouse.GetScrollY()}}}
class InputManager{constructor(){this.axis={},this.button={}}onAxis(t,n,i,s){this.axis[t]={down:i,value:n,up:s}}getAxis(t){if(!this.axis[t])return 0;var n=this.axis[t].value();return isNaN(n)?0:n}axisDown(t){if(!this.axis[t])return!1;var n=this.axis[t].down();return!!isBoolean(n)&&n}axisUp(t){if(!this.axis[t])return!1;var n=this.axis[t].up();return!!isBoolean(n)&&n}axisChanged(t){return this.axisDown(t)||this.axisUp(t)}buttonNotZero(t){return 0!=this.getButton(t)}onButton(t,n,i,s){this.button[t]={down:i,value:n,up:s}}getButton(t){if(!this.button[t])return 0;var n=this.button[t].value();return!!isBoolean(n)&&n}buttonDown(t){if(!this.button[t])return!1;var n=this.button[t].down();return!!isBoolean(n)&&n}buttonUp(t){if(!this.button[t])return!1;var n=this.button[t].up();return!!isBoolean(n)&&n}buttonChanged(t){return this.buttonDown(t)||this.buttonUp(t)}}
class Keyboard{static Create(){console.log("Initialising keyboard input");for(let K=0;K<Keyboard.KEY_NUM;K++)Keyboard.keys[K]=!1;document.addEventListener("keydown",K=>{Keyboard.keys[K.keyCode]=!0}),document.addEventListener("keyup",K=>{Keyboard.keys[K.keyCode]=!1})}static IsKeyDown(K){return Keyboard.keys[K]}}Keyboard.BACKSPACE=8,Keyboard.TAB=9,Keyboard.ENTER=13,Keyboard.SHIFT=16,Keyboard.CTRL=17,Keyboard.ALT=18,Keyboard.PAUSE=19,Keyboard.CAPS_LOCK=20,Keyboard.ESCAPE=27,Keyboard.SPACE=32,Keyboard.PAGE_UP=33,Keyboard.PAGE_DOWN=34,Keyboard.END=35,Keyboard.HOME=36,Keyboard.LEFT_ARROW=37,Keyboard.UP_ARROW=38,Keyboard.RIGHT_ARROW=39,Keyboard.DOWN_ARROW=40,Keyboard.INSERT=45,Keyboard.DELETE=46,Keyboard.KEY_0=48,Keyboard.KEY_1=49,Keyboard.KEY_2=50,Keyboard.KEY_3=51,Keyboard.KEY_4=52,Keyboard.KEY_5=53,Keyboard.KEY_6=54,Keyboard.KEY_7=55,Keyboard.KEY_8=56,Keyboard.KEY_9=57,Keyboard.KEY_A=65,Keyboard.KEY_B=66,Keyboard.KEY_C=67,Keyboard.KEY_D=68,Keyboard.KEY_E=69,Keyboard.KEY_F=70,Keyboard.KEY_G=71,Keyboard.KEY_H=72,Keyboard.KEY_I=73,Keyboard.KEY_J=74,Keyboard.KEY_K=75,Keyboard.KEY_L=76,Keyboard.KEY_M=77,Keyboard.KEY_N=78,Keyboard.KEY_O=79,Keyboard.KEY_P=80,Keyboard.KEY_Q=81,Keyboard.KEY_R=82,Keyboard.KEY_S=83,Keyboard.KEY_T=84,Keyboard.KEY_U=85,Keyboard.KEY_V=86,Keyboard.KEY_W=87,Keyboard.KEY_X=88,Keyboard.KEY_Y=89,Keyboard.KEY_Z=90,Keyboard.LEFT_META=91,Keyboard.RIGHT_META=92,Keyboard.SELECT=93,Keyboard.NUMPAD_0=96,Keyboard.NUMPAD_1=97,Keyboard.NUMPAD_2=98,Keyboard.NUMPAD_3=99,Keyboard.NUMPAD_4=100,Keyboard.NUMPAD_5=101,Keyboard.NUMPAD_6=102,Keyboard.NUMPAD_7=103,Keyboard.NUMPAD_8=104,Keyboard.NUMPAD_9=105,Keyboard.MULTIPLY=106,Keyboard.ADD=107,Keyboard.SUBTRACT=109,Keyboard.DECIMAL=110,Keyboard.DIVIDE=111,Keyboard.F1=112,Keyboard.F2=113,Keyboard.F3=114,Keyboard.F4=115,Keyboard.F5=116,Keyboard.F6=117,Keyboard.F7=118,Keyboard.F8=119,Keyboard.F9=120,Keyboard.F10=121,Keyboard.F11=122,Keyboard.F12=123,Keyboard.NUM_LOCK=144,Keyboard.SCROLL_LOCK=145,Keyboard.SEMICOLON=186,Keyboard.EQUALS=187,Keyboard.COMMA=188,Keyboard.DASH=189,Keyboard.PERIOD=190,Keyboard.FORWARD_SLASH=191,Keyboard.GRAVE_ACCENT=192,Keyboard.OPEN_BRACKET=219,Keyboard.BACK_SLASH=220,Keyboard.CLOSE_BRACKET=221,Keyboard.SINGLE_QUOTE=222,Keyboard.keys=[],Keyboard.KEY_NUM=256;
class Mouse{static Create(){console.log("Initialising mouse input");for(let e=0;e<Mouse.BUTTON_NUM;e++)Mouse.buttons[e]=!1;document.addEventListener("mousedown",e=>{Mouse.buttons[e.button]=!0}),document.addEventListener("mouseup",e=>{Mouse.buttons[e.button]=!1}),document.addEventListener("wheel",e=>{o&&clearTimeout(o),Mouse.scrollX=e.deltaX,Mouse.scrollY=e.deltaY;var o=setTimeout(Mouse.ResetScroll,50)}),document.addEventListener("mousemove",e=>{var o=e.pageX,t=e.pageY;Mouse.movementX=e.movementX||0,Mouse.movementY=e.movementY||0,void 0===o&&(o=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,t=e.clientY+document.body.scrollTop+document.documentElement.scrollTop),Mouse.x=o,Mouse.y=t})}static ResetScroll(){Mouse.scrollX=0,Mouse.scrollY=0}static ResetMovement(){Mouse.movementX=0,Mouse.movementY=0}static IsButtonDown(e){return Mouse.buttons[e]}static GetX(){return Mouse.x}static GetY(){return Mouse.y}static GetMovementX(){return Mouse.movementX}static GetMovementY(){return Mouse.movementY}static GetScrollX(){return Mouse.scrollX}static GetScrollY(){return Mouse.scrollY}}Mouse.LEFT_CLICK=0,Mouse.MIDDLE_CLICK=1,Mouse.RIGHT_CLICK=2,Mouse.BROWSER_BACK=3,Mouse.BROSWER_FORWARD=4,Mouse.buttons=[],Mouse.BUTTON_NUM=5,Mouse.x=0,Mouse.y=0,Mouse.movementX=0,Mouse.movementY=0,Mouse.scrollX=0,Mouse.scrollY=0;
class TouchHandler{constructor(){this.bind=createBinder(this),window.addEventListener("touchstart",this.bind("touchStart")),window.addEventListener("touchmove",this.bind("touchMove")),window.addEventListener("touchcancel",this.bind("touchEnd")),window.addEventListener("touchend",this.bind("touchEnd")),this.lastTouches=[]}touchStart(o){Array(...o.touches).forEach(o=>{window.onmousedown&&window.onmousedown(o),window.dispatchEvent(new MouseEvent("mousedown",o))}),this.lastTouches=Array(...o.touches)}touchMove(o){Array(...o.touches).forEach(o=>{window.onmousedown&&window.onmousemove(o),window.dispatchEvent(new MouseEvent("mousemove",o))}),this.lastTouches=Array(...o.touches)}touchEnd(o){var t=Array(...o.touches);0==o.touches.length&&(t=this.lastTouches),t.forEach(o=>{window.onmousedown&&window.onmouseup(o),window.dispatchEvent(new MouseEvent("mouseup",o))}),this.lastTouches=Array(...o.touches)}}
//# sourceMappingURL=game.min.js.map
